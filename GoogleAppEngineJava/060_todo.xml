<section id="todo">
	<title>Developing a task management web application</title>
	<section id="todo_overview">
		<title>Overview</title>
		<para>
			In the following exercise zou create a web app for a task management
			system using servlets
			and
			JSP's. The persistence will be
			handled by
			<ulink
				url="http://www.vogella.com/tutorials/JavaPersistenceAPI/article.html">JPA</ulink>
			. For
			an introduction into servlet please
			see
			<ulink url="http://www.vogella.com/tutorials/EclipseWTP/article.html"> Servlet and JSP development - Tutorial</ulink>

		</para>

		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/todo.png" />

				</imageobject>
			</mediaobject>
		</para>
	</section>
	<section id="todo_project">
		<title>Project</title>
		<para>
			Create a new project called <code>com.vogella.gae.java.todo</code> via
			<menuchoice>
				<guimenu>File</guimenu>
				<guisubmenu>New</guisubmenu>
				<guisubmenu>Web Application Project</guisubmenu>
			</menuchoice>
			. Package
			name is also <code>com.vogella.gae.java.todo</code>.
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/gae10.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para> The created project can already run. Right-click on your
			application, select run as-> Web
			Application
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/gae20.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para>This should start Jetty on http://localhost:8888/ . Open the url
			in the browser and you should the possibility to select your servlet
			and to start it. If you select it you should see a "Hello, world"
			message.
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/gae25.gif" />

				</imageobject>
			</mediaobject>
		</para>
	</section>
	<section id="todo_model">
		<title>Create your model</title>
		<para>
			Create the following class which will be our model. The
			<ulink
				url="http://www.vogella.com/tutorials/JavaPersistenceAPI/article.html">JPA</ulink>
			metadata is already added.
		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/model/Todo.java" />
			</programlisting>
		</para>


	</section>
	<section id="todo_jpa">
		<title>Setup JPA and your DAO</title>
		<para>
			To use JPA in your project you must create the JPA configuration
			file "persistence.xml" in the "META-INF" directory. This file
			contains
			the configuration that tells JPA to use the App Engine
			datastore.
		</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/jpa/persistence.xml" />
			</programlisting>
		</para>
		<para> The creation of the EntityManagerFactory is time-consuming
			therefore we buffer it.
		</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/jpa/EMFService.java" />
			</programlisting>
		</para>
		<para> The following class provides the possibility to query for all
			todos and to add and delete todos.
		</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/jpa/Dao.java" />
			</programlisting>
		</para>

	</section>

	<section id="todo_servlets">
		<title>Create servlets</title>

		<para> Create the following two servlets. The first will be called if
			a new Todo is created the second one if a Todo is finished.
		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/servlet/ServletCreateTodo.java" />
			</programlisting>
		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/servlet/ServletRemoveTodo.java" />
			</programlisting>
		</para>
	</section>

	<section id="todo_jsp">
		<title>Create JSP</title>
		<para>In the folder "war" create the following JSP
			"TodoApplication.jsp".
		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/jsp/TodoApplication.jsp" />
			</programlisting>
		</para>
		<para> The JSP refers to a css file. Create a folder "war/css" and
			create the following file "main.css".
		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/jsp/main.css" />
			</programlisting>
		</para>
	</section>


	<section id="todo_web">
		<title>web.xml</title>
		<para>
			Change
			<filename>web.xml</filename>
			in folder /war/WEB-INF" to the following. It
			will create the right
			servlet mapping and will set the JSP as start
			page.
		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/servlet/web.xml" />
			</programlisting>
		</para>
	</section>

	<section id="todo_runagain">
		<title>Run your application again</title>
		<para> You should be able to run your application locally, login and
			create and
			delete "Todos".
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/todo.gif" />

				</imageobject>
			</mediaobject>
		</para>
	</section>
	<section id="todo_application">
		<title>Maintain application</title>
		<para>
			To deploy your application to the GAE you need to maintain your
			application ID in the file "web/WEB-INF/appengine-web.xml". In the
			tag "application" maintain the application you have created in
			<ulink
				url="http://www.vogella.com/tutorials/GoogleAppEngineJava/article.html#register"> GAE/J Registration</ulink>
			. In my example I use the application "vogellatodo".

		</para>

		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/conf/appengine-web.xml" />
			</programlisting>
		</para>
	</section>
	<section id="todo_deploy">
		<title>Deploy your application</title>
		<para>
			Now deploy your application to the Google cloud. The following
			assumes that you have already created your account.
		</para>
		<para>Right-click on your project and select Google > App
			Engine
			Settings... from the context menu. Check that the application ID is
			as you maintained it in "appengine-web.xml".
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/gae30.png" />

				</imageobject>
			</mediaobject>
		</para>
		<para>
			Right-click on your project, Select Google -> Deploy to App
			Engine.
			You need to login with your Google account information.

			<para>
				<mediaobject>
					<imageobject>
						<imagedata fileref="images/deploy10.gif" />

					</imageobject>
				</mediaobject>
			</para>
		</para>
		<para>
			After
			the upload completes you will find
			your application online
			under
			http://application-id.appspot.com, e.g.
			in my case
			http://vogellatodo.appspot.com.
		</para>
	</section>
</section>